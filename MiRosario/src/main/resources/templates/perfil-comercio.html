<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MIR</title>
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>
</head>

<!-- fondo body  -->

<body style="background-image: url(/img/atardecer.jfif);">

    <!-- Menu responsive  -->
    <nav th:replace="/fragmentos/navbar :: navbar"></nav>

    <!-- Mensajes de exito y error -->

    <div th:replace="/fragmentos/mensajes :: error"></div>
    <div th:replace="/fragmentos/mensajes :: exito"></div>

    <!--<div th:object="${comercio}">-->
    <title>Perfil comercio</title>

    <div style="margin:m-1">

        <div class="header m-3 p-3" style="border-radius:20px">
            <img th:if="${comercio.foto != null}" th:src="${'/foto/comercio/' + comercio.id}" class="avatar">
            <img th:if="${comercio.foto == null}" src="/img/sinusuario.jpg" class="avatar">
            <h1 th:text="${comercio.nombreComercio}" style="color:white; padding:2rem; text-transform: uppercase; ">
            </h1>
        </div>

        <div class="contenido m-3 mb-3">
            <div class="socials"
                style="background-position:center; background-color:white; color:black; border-radius:20px">
                <div class="socials" style="background-color:white">
                    <h5 th:text="${comercio.descripcion}"></h5>
                    <hr>
                    <div class="" style="text-align:left">
                        <h5 th:text="'Zona: ' + ${comercio.zona}"></h5>
                        <hr>
                        <h5 th:text="'Direccion: '+ ${comercio.direccion}"></h5>
                        <hr>
                        <h5 th:text=" 'Telefono: '+ ${comercio.telefono}"></h5>
                        <hr>
                        <h5 th:text="'Mail: '+ ${comercio.mail}"></h5>
                        <hr>
                    </div>
                </div>

                <form sec:authorize="hasRole('ROLE_CLIENTE')" method="post"
                    th:action="@{/cliente/comercio-favorito(id=${session.usuariosesion.id},idComercio=${comercio.id})}">
                    <button class="btn btn-dark" type="submit">Agregar a favoritos</button>
                </form>
            </div>


            <div style="color:black; margin-top: 3rem;">
                <div class="d-flex justify-content-between" style="margin-bottom:1em;">

                    <h5 style="color:black;">Lista de Productos</h5>

                    <a sec:authorize="hasRole('ROLE_COMERCIO')" class="btn btn-dark"
                        th:href="@{/producto/guardar}">Agregar Producto</a>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Foto</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Descripcion</th>
                                <th scope="col">Precio</th>
                                <th sec:authorize="hasRole('ROLE_COMERCIO')" scope="col">Editar</th>
                                <th sec:authorize="hasRole('ROLE_COMERCIO')" scope="col">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${producto.alta == true}" th:each="producto : ${productos}">
                                <div>
                                    <td th:if="${producto.foto != null}"><img
                                            th:src="${'/foto/producto/' + producto.id}" style="border-radius:50%"
                                            width="100px" height="100px">
                                    </td>
                                    <td th:if="${producto.foto == null}"><img
                                        src="/img/sinusuario.jpg" style="border-radius:50%"
                                        width="100px" height="100px">
                                </td>
                                

                                </div>
                                <td th:text="${producto.nombre}"></td>
                                <td th:text="${producto.descripcion}"></td>
                                <td th:text="${producto.precio}"></td>
                                <td sec:authorize="hasRole('ROLE_COMERCIO')">
                                    <a class="btn btn-dark"
                                        th:href="@{/producto/editar(id=${producto.id},idComercio=${session.usuariosesion.id})}">Editar</a>
                                </td>

                                <td sec:authorize="hasRole('ROLE_COMERCIO')">
                                    <form method="POST"
                                        th:action="@{/producto/baja(id=${producto.id},idComercio=${session.usuariosesion.id})}">
                                        <button type="submit" class="btn btn-dark">Eliminar</button>
                                    </form>
                                </td>
                            </tr>
                            <tr th:if="${producto.alta == false || productos.isEmpty()}" th:each="producto : ${productos}"> 
                               <td>No hay productos para mostrar.</td>    
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>



            <div>
                <h5 class="align-self-center" style="color:black;">Comentarios</h5>
                <div class="card" th:if="${comentario.alta == true}" th:each="comentario : ${comentarios}">
                    <div class="card-header d-flex justify-content-left align-items-center">

                            <img th:if="${comentario.cliente.foto != null}" th:src="${'/foto/cliente/'+ comentario.cliente.id}" class="avatarNAV">
                            <img th:if="${comentario.cliente.foto == null}" src="/img/sinusuario.jpg" class="avatarNAV">

                        <h5 style="padding-left: 0.5rem; text-transform: capitalize;"
                            th:text="${comentario.cliente.nombreUsuario}"></h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text" style="text-align: start;" th:text="${comentario.descripcion}"></p>
                        <form style="text-align: end;" method="POST" sec:authorize="hasRole('ROLE_CLIENTE')"
                            th:if="${comentario.cliente.id == session.usuariosesion.id}"
                            th:action="@{/comentario/baja(id=${session.usuariosesion.id},idComentario=${comentario.id},idComercio=${comercio.id})}">
                            <button type="submit" class="btn btn-dark">Eliminar</button>
                        </form>
                    </div>

                </div>

                <form class="mt-3 d-flex justify-content-between aling-self-middle " method="POST"
                    sec:authorize="hasRole('ROLE_CLIENTE')"
                    th:action="@{/comentario/guardar(id=${session.usuariosesion.id},idComercio=${comercio.id})}">
                    <input class="flex-fill pe-2"
                        style="margin-right: 1%; border-radius: 0.25rem; border-color: #343a40;" type="text"
                        name="descripcion" rows="10" cols="40" placeholder="Escribe un comentario...">
                    <button type="submit" class="btn btn-dark">Agregar comentario</button>
                </form>

            </div>

        </div>

    </div>



    <!--Container quienes somos-->
    <div th:replace="/fragmentos/quienesSomos :: quienesSomos"></div>
    <!--footer pie de pagina-->
    <footer th:replace="/fragmentos/footer :: footer"></footer>
    <!-- scripts-->
    <div th:replace="/fragmentos/scripts :: scripts"></div>

</body>

</html>