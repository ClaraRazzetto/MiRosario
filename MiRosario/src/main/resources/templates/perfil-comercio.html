<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MIR</title>
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>
</head>

<!-- fondo body  -->

<body style="background-image: url(/img/atardecer.jfif);">

    <!-- Menu responsive  -->
    <nav th:replace="/fragmentos/navbar :: navbar"></nav>

    <!-- Mensajes de exito y error -->

    <div th:replace="/fragmentos/mensajes :: error"></div>
    <div th:replace="/fragmentos/mensajes :: exito"></div>

    <!--<div th:object="${comercio}">-->
    <title>Perfil comercio</title>

    <div style="margin:2rem">

        <div class="header">
            <img class="avatar" src="/img/coto.png">
            <h1 th:text="${comercio.nombreComercio}" style="color:black"></h1>
        </div>

        <div class="col-sm-12" style="text-align:right; margin:2rem; margin-left:5px; background-color: white">
            <div class="socials">
                <div class="" style="margin-right:30%">
                    <p th:text="${comercio.descripcion}"></p>
                    <hr>
                    <p th:text="'Zona ' + ${comercio.zona}"></p>
                    <hr>
                    <p th:text="${comercio.direccion}"></p>
                    <hr>
                    <p th:text="${comercio.telefono}"></p>
                    <hr>
                    <p th:text="${comercio.mail}"></p>
                </div>

                <form sec:authorize="hasRole('ROLE_CLIENTE')" method="post"
                    th:action="@{/cliente/comercio-favorito(id=${session.usuariosesion.id},idComercio=${comercio.id})}">
                    <button style="margin:20px" type="submit">Agregar a favoritos</button>
                </form>
            </div>

            <div th:if="${producto.alta == true}" th:each="producto : ${productos}">
                <caption>Lista de Productos</caption>
                <a class="btn btn-primary" th:href="@{/producto/guardar}">Agregar Producto</a>
                <table class="table caption-top">
                    <thead>
                        <tr>
                            <th scope="col">Foto</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Descripcion</th>
                            <th scope="col">Precio</th>
                            <th sec:authorize="hasRole('ROLE_COMERCIO')" scope="col">Editar</th>
                            <th sec:authorize="hasRole('ROLE_COMERCIO')" scope="col">Eliminar</th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td> Foto</td>
                            <td th:text="${producto.nombre}"></td>
                            <td th:text="${producto.descripcion}"></td>
                            <td th:text="${producto.precio}"></td>
                            <td>
                                <a class="btn btn-primary"
                                    th:href="@{/producto/editar(id=${producto.id},idComercio=${session.usuariosesion.id})}">Editar</a>
                            </td>
                            <td sec:authorize="hasRole('ROLE_COMERCIO')">
                                <form method="POST"
                                    th:action="@{/producto/baja(id=${producto.id},idComercio=${session.usuariosesion.id})}">
                                    <button type="submit" class="btn btn-primary">Eliminar</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card mb-2">
                
                <div class="card" th:if="${comentario.alta == true}" th:each="comentario : ${comentarios}">
                    <div class="card-header">
                        <h5 th:text="${comentario.cliente.nombreUsuario}"></h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text" th:text="${comentario.descripcion}"></p>
                        <form method="POST" sec:authorize="hasRole('ROLE_CLIENTE')"
                            th:if="${comentario.cliente.id == session.usuariosesion.id}"
                            th:action="@{/comentario/baja(id=${session.usuariosesion.id},idComentario=${comentario.id},idComercio=${comercio.id})}">
                            <button type="submit" class="btn btn-primary">Eliminar</button>
                        </form>
                    </div>
                </div>

                <form class="m-3" method="POST" sec:authorize="hasRole('ROLE_CLIENTE')"
                    th:action="@{/comentario/guardar(id=${session.usuariosesion.id},idComercio=${comercio.id})}">
                    <input type="text" name="descripcion" rows="10" cols="40" placeholder="Escribe un comentario...">
                    <button type="submit" class="btn btn-primary">Agregar comentario</button>
                </form>

            </div>

        </div>

    </div>



    <!--Container quienes somos-->
    <div th:replace="/fragmentos/quienesSomos :: quienesSomos"></div>
    <!--footer pie de pagina-->
    <footer th:replace="/fragmentos/footer :: footer"></footer>
    <!-- scripts-->
    <div th:replace="/fragmentos/scripts :: scripts"></div>

</body>

</html>